name: Java CI with Maven

on:
#  –∑–∞–ø—É—Å–∫ –ø—Ä–∏ push
  push:
    branches: [ main ]
#  –∑–∞–ø—É—Å–∫ –ø—Ä–∏ pull
  pull_request:
    branches: [ main ]
  workflow_dispatch:
  # –∑–∞–ø—É—Å–∫ workflow –≤—Ä—É—á–Ω—É—é –∏–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ GitHub
  

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
#        –ø—Ä–æ–≤–µ—Ä–∫–∞
      - name: Set up JDK 21
        uses: actions/setup-java@v2
        # –∏—Å–ø–æ–ª—å–∑—É–µ–º JDK21

        with:
          java-version: '21'
          distribution: 'adopt'

      - name: Build with Maven  # —Ç–∞–∫ –∫–∞–∫ —Å–æ–±–∏—Ä–∞–ª–∏ —Å Maven, —É–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ
        run: mvn -B package --file pom.xml
        # –ø–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º + —É–∫–∞–∑—ã–≤–∞–µ–º pom-–Ω–∏–∫

      - name: Run tests
        run: mvn test | tee test-results.txt
        # –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤



      - name: Notify Telegram on success
        if: success()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" -d chat_id=${{ secrets.CHAT_ID }} -d text="‚úÖüêà–°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ"

      - name: Notify Telegram on failure
        if: failure()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" -d chat_id=${{ secrets.CHAT_ID }} -d text="‚ö°Ô∏è–°–±–æ—Ä–∫–∞ –∏–ª–∏ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏. $TEST_RESULTS"
